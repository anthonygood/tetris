(()=>{var t={302:(t,e,o)=>{const{countNeighbourValues:r,map:i}=o(803),s=(t,e)=>Number(((t,e)=>3===e||t&&2===e)(t,e)),n=(t,e,o,i)=>s(t,r(e,i));t.exports={countNeighbourValues:r,liveOrDie:s,tick:t=>i(t,n)}},803:t=>{const e=(t,e,o=0)=>Array.from({length:e}).map((()=>new Array(t).fill(o))),o=t=>t.length,r=t=>t[0]?.length,i=(t,e)=>t.forEach(((o,r)=>o.forEach(((i,s)=>e(i,[r,s],o,t))))),s=(t,e)=>t.map(((o,r)=>o.map(((i,s)=>e(i,[r,s],o,t))))),n=t=>t.reduce(((t,e)=>Array.isArray(e)?t.concat(n(e)):t.concat(e)),[]),h=([t,e],o,r)=>{for(let i=t-1;i<=t+1;i++)for(let s=e-1;s<=e+1;s++){if(i===t&&s===e)continue;const n=o[i]&&o[i][s];void 0!==n&&r(n,i,s,o)}},a=(t,e,o)=>{const r=[];return h(t,e,(t=>r.push(o(t)))),r},c=(t,e)=>t.length>e.length?t:e,l=t=>s=>{const n=r(s),h=o(s),a=e(h,n);return i(s,((e,[o,r],i,s)=>{const[c,l]=t(o,r,n,h);a[c][l]=e})),a},d=l(((t,e,o,r)=>[e,r-1-t])),u=l(((t,e,o,r)=>[o-1-e,t])),m=t=>(o,r,i=0)=>{const{length:n}=c(o,r),{length:h}=c(o[0],r[0]);return s(e(h,n),((e,[s,n],h,a)=>t(o[s]?.[n],r[s]?.[n],i)))},f=m(((t,e,o)=>t||e||o)),p=m(((t=0,e=0)=>t+e)),v=m(((t=0,e=0)=>t&&e));t.exports={add:p,blank:e,countNeighbourValues:(t,e)=>((t,e)=>a(t,e,(t=>t)))(t,e).reduce(((t,e)=>t+e),0),debug:(t,e=!1)=>{t.map((t=>e?t.join(","):t)).forEach((t=>console.log(t)))},forEach:i,findIndex:(t,e)=>{for(let o=0;o<t.length;o++)for(let r=0;r<t[o].length;r++)if(e(t[o][r],[o,r],t[o],t))return[o,r]},flatten:n,forEveryNeighbour:h,height:o,intersection:v,map:s,mapNeighbours:a,superimpose:(t,s,n,h,{crop:a}={})=>{const c=r(t),l=o(t),d=e(c,l);return i(s,((t,[e,o],r,i)=>{const s=e+h,u=o+n;if(s>=l||u>=c||s<0||u<0){if(a)return;throw new Error("Superimposed grid would be out of bounds")}d[s][u]=t})),f(t,d)},reduce:(t,...e)=>n(t).reduce(...e),rotateAntiClockwise:u,rotateClockwise:d,union:f,width:r}},702:(t,e,o)=>{const{blank:r,countNeighbourValues:i,forEveryNeighbour:s,map:n}=o(803),h=t=>Math.floor(Math.random()*t.length),a=(t,e,o)=>t>=e&&t<=o,c=([t,e],o)=>{const[r,i]=o;return a(r,t-1,t+1)&&a(i,e-1,e+1)},l=(t,e,o=0,s=[])=>n(((t,e,o=0,i=[])=>{t=Math.max(t,3),e=Math.max(e,3);const s=r(t,e,0);let n=Math.min(o,t*e-9);for(;n;){const t=h(s),e=h(s[t]),o=s[t][e];c(i,[t,e])||1===o||(s[t][e]=1,n--)}return s})(t,e,o,s),((t,e,o,r)=>t?"x":i(e,r))),d=(t,e,o,r)=>{if(-1!==t[o][r])return;const i=e[o][r];return t[o][r]=i,i<1&&s([o,r],e,((e,o,r,i)=>{d(t,i,o,r)})),t},u=t=>{const e=n(t,(()=>-1));return(o,r)=>"x"===t[o][r]?null:(d(e,t,o,r),e)};t.exports={newBoard:l,nextState:u,Minesweeper:class{constructor(t,e,o){this.width=t,this.height=e,this.mineCount=o,this.board=null,this.state=null,this.moves=[]}move(t,e){const{width:o,height:r,mineCount:i}=this;return this.moves.push([t,e]),this.board||(this.board=l(o,r,i,[t,e]),this.next=u(this.board)),"x"!==this.board[t][e]&&(this.state=this.next(t,e),!0)}}}},419:(t,e,o)=>{const r=o(803);Events={},Events.TETROMINO_SPAWN="tetromino:spawn",Events.TETROMINO_LANDING="tetromino:landing",Events.TICK="tick",Events.LINE_CLEAR="lineclear",Events.GAME_OVER="gameover";const i=(t,e,o)=>Math.max(Math.min(o,e),t);class s{constructor(t,e){this.values=[],this.length=t,this.getValFn=e}init(){const{values:t,getValFn:e,length:o}=this;for(;t.length<o;)this.values.unshift(e())}pop(){const{values:t,getValFn:e}=this,o=t.pop();return this.values.unshift(e()),o}}const n=(t,e=t.tetromino,o=t.tetrominoPosition,s=!1)=>{const[n,h]=o,a=r.width(e),c=r.height(e),l=n-t.centre(a),d=h-t.centre(c),u=s?1:0;return[i(0,t.width()-a,l),i(0,t.height()-c+u,d)]},h=(t,e)=>()=>{const o=e(t.tetromino);return!t.detectCollisions(o,...t.tetrominoPosition)&&(t.tetromino=o,!0)};class a{constructor(t=10,e=20,o=!0,n=5){this.board=r.blank(t,e),this.gravityEnabled=o,this.tetromino=null,this.tetrominoPosition=null,this.ticks=0,this.buffer=new s(n,this.randomTetromino),this.bufferSize=n,this.eventListeners={[Events.TICK]:[],[Events.TETROMINO_SPAWN]:[],[Events.TETROMINO_LANDING]:[],[Events.LINE_CLEAR]:[],[Events.GAME_OVER]:[]},this.rotate=h(this,a.Tetromino.rotate),this.rotate.reverse=h(this,a.Tetromino.rotate.reverse),this.clamp={x:i.bind(null,0,t-1),y:i.bind(null,0,e-1)}}getSubscribers(t){const e=this.eventListeners[t];if(!e)throw new Error(`Event '${t}' not supported`);return e}on(t,e){this.getSubscribers(t).push(e)}trigger(t,e){this.getSubscribers(t).forEach((t=>t(e)))}start(){this.buffer.init(),this.spawn()}spawn(t=this.buffer.pop()){if(!t||!t.length||!t[0].length)throw new TypeError("Must provide two dimensional array representing tetromino to spawn");if(this.tetromino=t,this.trigger(Events.TETROMINO_SPAWN,{tetromino:t}),this.tetrominoPosition=[this.centre(),2],!this.detectCollisions(t,...this.tetrominoPosition))return;let e=0;for(;this.detectCollisions(t,...this.tetrominoPosition);)if(this.tetrominoPosition[1]--,e++,e>4)throw new Error(`Spawn failure: ${this.tetrominoPosition}`);this.board=this.compositeBoard(),this.trigger(Events.GAME_OVER,{board:this.board,ticks:this.ticks})}tick(){if(!this.clearLines()){if(this.tetrominoHasReachedBottom()||this.tetrominoHasLandedOnTerrain())return this.trigger(Events.TETROMINO_LANDING,{ticks:this.ticks,tetromino:this.tetromino,position:this.tetrominoPosition,projectedPosition:n(this)}),this.board=this.compositeBoard(),void(this.tetromino=null);this.tetromino?this.gravityEnabled&&(this.tetrominoPosition=this.gravity()):this.spawn(),this.trigger(Events.TICK,{board:this.board,ticks:++this.ticks})}}_move(t,e,o=!1){return!this.detectCollisions(this.tetromino,t,e,o)&&(this.tetrominoPosition=[this.clamp.x(t),this.clamp.y(e)],!0)}get move(){const t=this;return{left(){const[e,o]=t.tetrominoPosition;return t._move(e-1,o)},right(){const[e,o]=t.tetrominoPosition;return t._move(e+1,o)},down:()=>t._move(...t.gravity(),!0)}}fallPosition(){const{tetromino:t,tetrominoPosition:e}=this,[o]=e;let[,r]=e;for(;!this.detectCollisions(t,o,r+1,!0);)r++;return[o,r]}drop(){this.tetrominoPosition=this.fallPosition(),this.tick()}tetrominoGhost(){return this.compositeBoard(r.blank(this.width(),this.height()),this.tetromino,this.fallPosition())}gravity(){const[t,e]=this.tetrominoPosition;return[t,e+1]}detectCollisions(t,e,o,i=!1){const s=r.blank(this.width(),this.height());let h;try{const a=n(this,t,[e,o],i);h=r.superimpose(s,t,...a)}catch(t){return!0}return r.add(this.board,h).flat().some((t=>t>1))}randomTetromino(){const{Tetromino:t}=a,e=[t.L,t.T,t.skew,t.square,t.straight],o=Math.floor(Math.random()*e.length),r=!!Math.floor(2*Math.random()),i=e[o];return r?i.reverse():i()}tetrominoHasLandedOnTerrain(){const{tetromino:t}=this;if(!t)return!1;const e=this.gravity();return this.detectCollisions(t,...e,!0)}tetrominoHasReachedBottom(t=this.tetromino,e=this.tetrominoPosition){if(!t)return!1;const[,o]=n(this,t,e,!0);return o+r.height(t)-1>=this.height()}clearLines(){const t=this.board.filter((t=>t.some((t=>0===t))));if(t.length===this.height())return!1;const e=this.board.reduce(((t,e,o)=>(e.filter(Boolean).length===this.width()&&(t.total+=1,t.indices.push(o)),t)),{ticks:this.ticks,total:0,indices:[],board:{before:[...this.board]}});e.board.completedLines=this.board.map(((t,o)=>{const r=e.indices.includes(o)?1:0;return new Array(this.width()).fill(r)}));const o=r.blank(this.width(),e.total);return this.board=e.board.after=o.concat(t),this.trigger(a.Events.LINE_CLEAR,e),!0}compositeBoard(t=this.board,e=this.tetromino,o=this.tetrominoPosition){if(!e)return t;const i=n(this,e,o);return r.superimpose(t,e,...i)}height(){return r.height(this.board)}width(){return r.width(this.board)}centre(t=this.width()){return Math.floor(t/2)}}const c=t=>r.rotateClockwise(t);c.reverse=r.rotateAntiClockwise;const l=t=>{var e;return fn=()=>t,fn.reverse=(e=t,()=>e.map((t=>[...t].reverse()))),fn},d=l([[1,1,1],[0,1,0]]),u=l([[1,1,1],[1,0,0]]),m=l([[0,1,1],[1,1,0]]),f=l([[1,1],[1,1]]),p=l([[1,1,1,1]]);a.Tetromino={T:d,L:u,skew:m,square:f,straight:p,rotate:c},a.Events=Events,t.exports={Tetris:a}},978:(t,e,o)=>{const r=o(803),i=o(302),{Minesweeper:s}=o(702),{Tetris:n}=o(419);t.exports={Grid:r,GameOfLife:i,Minesweeper:s,Tetris:n}}},e={};function o(r){var i=e[r];if(void 0!==i)return i.exports;var s=e[r]={exports:{}};return t[r](s,s.exports,o),s.exports}(()=>{"use strict";var t=o(978);const e={},r=(t,e)=>{new Array(t).fill(0).forEach(e)},i={left:"KeyA",right:"KeyD",down:"KeyS",rotateRight:"KeyW",rotateLeft:"KeyE",pause:"KeyP"};(()=>{const o=new t.Tetris,{appContainer:s,domCells:n}=((t,e)=>{const o=document.querySelector("#app"),i=[],s=[];return r(t,(()=>{const t=document.createElement("div");t.classList.add("row"),i.push(t);const n=[];r(e,(()=>{const e=document.createElement("div");e.classList.add("cell"),t.appendChild(e),n.push(e)})),o.appendChild(t),s.push(n)})),{appContainer:o,domRows:i,domCells:s}})(o.height(),o.width());o.start();const h=((t,e)=>(o=t.compositeBoard())=>{for(let r=0;r<t.height();r++)for(let i=0;i<t.width();i++){const t=!!o[r][i],s=e[r][i];if(!s)return console.error("cell not found at index",r,i);t?s.classList.add("active"):s.classList.remove("active")}})(o,n),{start:a,stop:c}=(({tickFn:t,renderFn:o,tickInterval:r,frameInterval:i})=>({start:()=>{e.tickInterval=setInterval(t,r),e.renderInterval=setInterval((()=>requestAnimationFrame((()=>o()))),i)},stop:()=>{clearInterval(e.tickInterval),clearInterval(e.renderInterval)}}))({tickFn:()=>o.tick(),renderFn:h,tickInterval:250,frameInterval:50});o.on(t.Tetris.Events.GAME_OVER,((t,e)=>()=>{e.classList.add("gameover"),t()})(c,s)),o.on(t.Tetris.Events.LINE_CLEAR,((t,e,o,r)=>i=>{const{indices:s,board:n}=i;o(n.before),e(),s.forEach((t=>{r[t].forEach((t=>t.classList.add("flash")))})),setTimeout((()=>{t(),s.forEach((t=>{r[t].forEach((t=>t.classList.remove("flash")))}))}),500)})(a,c,h,n));const l=((t,e,o)=>r=>{"Escape"===r.code&&(t.paused?e():o(),t.paused=!t.paused)})(o,a,c);document.addEventListener("keydown",(t=>e=>{if(t.paused)return;const{code:o}=e;"ArrowRight"!==o&&o!==i.right||t.move.right(),"ArrowLeft"!==o&&o!==i.left||t.move.left(),"ArrowDown"!==o&&o!==i.down||t.move.down(),"Space"!==o&&o!==i.rotateRight||t.rotate(),o===i.rotateLeft&&t.rotate.reverse(),"Enter"!==o&&o!==i.drop||t.drop()})(o)),document.addEventListener("keydown",l),a()})()})()})();